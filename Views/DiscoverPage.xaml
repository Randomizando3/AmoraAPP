<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AmoraApp.Views.DiscoverPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="White"
    Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*,Auto">

        <Image
            Source="background.jpg"
            Aspect="AspectFill"
            Grid.RowSpan="3" />

        <!-- HEADER -->
        <Grid Grid.Row="0"
              Padding="16,24,16,8"
              ColumnDefinitions="*,Auto"
              VerticalOptions="Start">

            <Label
                Grid.Column="0"
                Text="Descubra"
                FontSize="24"
                FontAttributes="Bold"
                TextColor="White"
                HorizontalOptions="Start"
                VerticalOptions="Center" />

            <ImageButton
                Grid.Column="1"
                Source="filter.png"
                BackgroundColor="Transparent"
                WidthRequest="24"
                HeightRequest="24"
                HorizontalOptions="End"
                VerticalOptions="Center"
                Clicked="OnFilterHeaderClicked" />
        </Grid>

        <!-- CARD CENTRAL -->
        <Grid Grid.Row="1"
              Padding="16,0,16,0">

            <Border
                x:Name="SwipeCard"
                BackgroundColor="White"
                Stroke="#E5E5E5"
                StrokeThickness="2"
                HorizontalOptions="FillAndExpand"
                VerticalOptions="FillAndExpand"
                MinimumWidthRequest="320"
                MaximumWidthRequest="360"
                Margin="0,8,0,8">

                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="20" />
                </Border.StrokeShape>

                <Grid RowDefinitions="3*,Auto,Auto">

                    <!-- TEM PERFIL -->
                    <Grid Grid.RowSpan="3" IsVisible="{Binding HasUser}">
                        <Grid RowDefinitions="3*,Auto,Auto">

                            <!-- FOTO -->
                            <Grid Grid.Row="0">
                                <Border StrokeThickness="0">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="20,20,0,0" />
                                    </Border.StrokeShape>

                                    <Image
                                        Source="{Binding CurrentUser.PhotoUrl}"
                                        Aspect="AspectFill"
                                        HorizontalOptions="FillAndExpand"
                                        VerticalOptions="FillAndExpand" />
                                </Border>
                            </Grid>

                            <!-- INFOS -->
                            <StackLayout Grid.Row="1"
                                         Padding="16,10,16,4"
                                         Spacing="2">

                                <StackLayout Orientation="Horizontal" Spacing="4">
                                    <Label Text="{Binding CurrentUser.DisplayName}"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="#222222" />

                                    <Label Text=", "
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="#222222" />

                                    <Label Text="{Binding CurrentUser.Age}"
                                           FontSize="20"
                                           FontAttributes="Bold"
                                           TextColor="#222222" />
                                </StackLayout>

                                <Label Text="{Binding CurrentUser.City}"
                                       FontSize="13"
                                       TextColor="#777777" />

                                <Label Text="{Binding CurrentUser.JobTitle}"
                                       FontSize="13"
                                       TextColor="#555555"
                                       LineBreakMode="TailTruncation" />

                                <Label Text="{Binding CurrentUser.EducationLevel}"
                                       FontSize="12"
                                       TextColor="#888888"
                                       LineBreakMode="TailTruncation" />

                                <Label Text="{Binding CurrentUser.Bio}"
                                       FontSize="13"
                                       TextColor="#666666"
                                       LineBreakMode="TailTruncation" />

                            </StackLayout>

                            <!-- BADGES + INTERESSES -->
                            <StackLayout Grid.Row="2"
                                         Padding="16,0,16,12"
                                         Spacing="8">

                                <!-- BADGES -->
                                <StackLayout Orientation="Horizontal" Spacing="10">

                                    <!-- BOOST ATIVO -->
                                    <Border
                                        BackgroundColor="#FFF5E6"
                                        Stroke="#FFC266"
                                        StrokeThickness="2"
                                        IsVisible="{Binding CurrentUser.IsBoostActive}">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>

                                        <StackLayout Orientation="Horizontal"
                                                     Padding="10,4"
                                                     Spacing="4">
                                            <Image Source="boost.png"
                                                   WidthRequest="14"
                                                   HeightRequest="14"
                                                   VerticalOptions="Center" />
                                            <Label Text="BOOST"
                                                   FontAttributes="Bold"
                                                   FontSize="11"
                                                   TextColor="#CC7A00"
                                                   VerticalOptions="Center" />
                                        </StackLayout>
                                    </Border>

                                    <!-- ONLINE -->
                                    <Border BackgroundColor="#FFE7F4"
                                            Stroke="#F3C9E2"
                                            StrokeThickness="2">

                                        <Border.Triggers>
                                            <DataTrigger TargetType="Border"
                                                         Binding="{Binding OnlineText}"
                                                         Value="">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border"
                                                         Binding="{Binding OnlineText}"
                                                         Value="{x:Null}">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </Border.Triggers>

                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>

                                        <Label Text="{Binding OnlineText}"
                                               Margin="10,4"
                                               TextColor="#5d259c"
                                               FontSize="11" />
                                    </Border>

                                    <!-- DISTÂNCIA -->
                                    <Border BackgroundColor="#F0F0F0"
                                            Stroke="#DDDDDD"
                                            StrokeThickness="2">

                                        <Border.Triggers>
                                            <DataTrigger TargetType="Border"
                                                         Binding="{Binding DistanceText}"
                                                         Value="">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                            <DataTrigger TargetType="Border"
                                                         Binding="{Binding DistanceText}"
                                                         Value="{x:Null}">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </Border.Triggers>

                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="12" />
                                        </Border.StrokeShape>

                                        <Label Text="{Binding DistanceText}"
                                               Margin="10,4"
                                               TextColor="#555555"
                                               FontSize="11" />
                                    </Border>

                                </StackLayout>

                                <!-- INTERESSES -->
                                <FlexLayout Wrap="Wrap"
                                            AlignItems="Center"
                                            BindableLayout.ItemsSource="{Binding CurrentUser.Interests}">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate>
                                            <Frame Padding="8,4"
                                                   Margin="0,4,6,4"
                                                   BackgroundColor="#FFE7F4"
                                                   BorderColor="#F3C9E2"
                                                   CornerRadius="12"
                                                   HasShadow="False">
                                                <Label Text="{Binding .}"
                                                       FontSize="11"
                                                       TextColor="#5d259c" />
                                            </Frame>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </FlexLayout>
                            </StackLayout>

                        </Grid>
                    </Grid>

                    <!-- SEM PERFIL -->
                    <Grid IsVisible="{Binding HasNoUser}">
                        <StackLayout HorizontalOptions="Center"
                                     VerticalOptions="Center"
                                     Padding="24"
                                     Spacing="8">

                            <Label Text="Nada por aqui por enquanto"
                                   FontAttributes="Bold"
                                   FontSize="18"
                                   HorizontalTextAlignment="Center"
                                   TextColor="#222" />

                            <Label Text="Não há perfis para exibir no momento. Tente ajustar os filtros ou volte mais tarde."
                                   FontSize="13"
                                   HorizontalTextAlignment="Center"
                                   TextColor="#777" />
                        </StackLayout>
                    </Grid>

                </Grid>

                <Border.GestureRecognizers>
                    <PanGestureRecognizer PanUpdated="OnSwipe" />
                    <TapGestureRecognizer Tapped="OnCardTapped" />
                </Border.GestureRecognizers>

            </Border>

        </Grid>

        <!-- RODAPÉ – BOTÕES CIRCULARES -->
        <Grid Grid.Row="2"
              Padding="0,0,0,16"
              HorizontalOptions="Center"
              VerticalOptions="End">

            <HorizontalStackLayout Spacing="8"
                                   HorizontalOptions="Center">

                <!-- REWIND (menor) -->
                <Border HeightRequest="56"
                        WidthRequest="56"
                        BackgroundColor="#F3F3F3"
                        Stroke="#E0E0E0"
                        StrokeThickness="2">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="28" />
                    </Border.StrokeShape>

                    <!-- colorido quando pode voltar -->
                    <Border.Triggers>
                        <DataTrigger TargetType="Border"
                                     Binding="{Binding CanRewind}"
                                     Value="True">
                            <Setter Property="BackgroundColor" Value="#FFE7F4" />
                            <Setter Property="Stroke" Value="#F3C9E2" />
                        </DataTrigger>
                    </Border.Triggers>

                    <Border.GestureRecognizers>
                        <TapGestureRecognizer Command="{Binding RewindCommand}" />
                    </Border.GestureRecognizers>

                    <Image Source="back.png"
                           WidthRequest="26"
                           HeightRequest="26"
                           Opacity="0.35"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Image.Triggers>
                            <DataTrigger TargetType="Image"
                                         Binding="{Binding CanRewind}"
                                         Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </DataTrigger>
                        </Image.Triggers>
                    </Image>
                </Border>

                <!-- DISLIKE (maior) -->
                <Border HeightRequest="68"
                        WidthRequest="68"
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="2">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="34" />
                    </Border.StrokeShape>
                    <Image Source="no.png"
                           WidthRequest="36"
                           HeightRequest="36"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding DislikeCommand}" />
                        </Image.GestureRecognizers>
                    </Image>
                </Border>

                <!-- ADD FRIEND (menor) -->
                <Border HeightRequest="56"
                        WidthRequest="56"
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="2">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="28" />
                    </Border.StrokeShape>
                    <Image Source="add.png"
                           WidthRequest="26"
                           HeightRequest="26"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding AddFriendCommand}" />
                        </Image.GestureRecognizers>
                    </Image>
                </Border>

                <!-- LIKE (maior) -->
                <Border HeightRequest="68"
                        WidthRequest="68"
                        BackgroundColor="White"
                        Stroke="#E0E0E0"
                        StrokeThickness="2">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="34" />
                    </Border.StrokeShape>
                    <Image Source="heart.png"
                           WidthRequest="36"
                           HeightRequest="36"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Image.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding LikeCommand}" />
                        </Image.GestureRecognizers>
                    </Image>
                </Border>

                <!-- BOOST (menor, com gradiente) -->
                <Border HeightRequest="56"
                        WidthRequest="56"
                        Stroke="#E0E0E0"
                        StrokeThickness="2">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="28" />
                    </Border.StrokeShape>

                    <Grid>
                        <Grid.Background>
                            <LinearGradientBrush StartPoint="0,0"
                                                 EndPoint="1,1">
                                <GradientStop Color="#5d259c" Offset="0" />
                                <GradientStop Color="#FF9966" Offset="1" />
                            </LinearGradientBrush>
                        </Grid.Background>

                        <Image Source="boost.png"
                               WidthRequest="26"
                               HeightRequest="26"
                               HorizontalOptions="Center"
                               VerticalOptions="Center">
                            <Image.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnBoostTapped" />
                            </Image.GestureRecognizers>
                        </Image>
                    </Grid>
                </Border>

            </HorizontalStackLayout>
        </Grid>

    </Grid>

</ContentPage>
