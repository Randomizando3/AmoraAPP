<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="AmoraApp.Views.ChatPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    BackgroundColor="#FFF5F9"
    Shell.NavBarIsVisible="False">

    <!-- GRID PRINCIPAL -->
    <Grid RowDefinitions="Auto,*,Auto" Padding="0">

        <!-- HEADER -->
        <Grid Grid.Row="0"
              Padding="12,32,12,12"
              ColumnDefinitions="Auto,*,Auto"
              VerticalOptions="Start">

            <!-- Voltar -->
            <ImageButton
                Source="back.png"
                WidthRequest="28"
                HeightRequest="28"
                BackgroundColor="Transparent"
                Clicked="OnBackButtonClicked" />

            <!-- Nome + status -->
            <StackLayout Grid.Column="1"
                         Orientation="Vertical"
                         Spacing="0"
                         Margin="12,0,0,0"
                         VerticalOptions="Center">
                <Label
                    x:Name="UserNameLabel"
                    Text="Contato"
                    FontSize="18"
                    FontAttributes="Bold"
                    TextColor="#222222" />
                <Label
                    x:Name="StatusLabel"
                    Text="Online"
                    FontSize="12"
                    TextColor="#5d259c" />
            </StackLayout>

            <!-- Chamada -->
            <ImageButton
                Grid.Column="2"
                Source="call.png"
                WidthRequest="28"
                HeightRequest="28"
                BackgroundColor="Transparent"
                HorizontalOptions="End"
                VerticalOptions="Center"
                Clicked="OnCallTapped" />

        </Grid>

        <!-- MENSAGENS -->
        <ScrollView
            x:Name="MessagesScroll"
            Grid.Row="1"
            Padding="12,0,12,0">
            <VerticalStackLayout
                x:Name="MessagesStack"
                Spacing="6"
                Padding="0,0,0,8" />
        </ScrollView>

        <!-- INPUT + GRAVAÇÃO -->
        <Grid Grid.Row="2"
              Padding="8,4,8,8"
              RowDefinitions="Auto,Auto"
              RowSpacing="4">

            <!-- BARRA DE GRAVAÇÃO (mostra só enquanto grava) -->
            <Grid x:Name="RecordingBar"
                  Grid.Row="0"
                  IsVisible="False"
                  ColumnDefinitions="Auto,*,Auto"
                  Padding="8"
                  BackgroundColor="#FFEDE7F6"
                  Margin="0,0,0,4">

                <BoxView
                    WidthRequest="10"
                    HeightRequest="10"
                    Color="#FFEB5757"
                    CornerRadius="5"
                    VerticalOptions="Center" />

                <Label
                    Grid.Column="1"
                    x:Name="RecordingTimeLabel"
                    Text="Gravando... 00s"
                    FontSize="12"
                    TextColor="#333333"
                    VerticalOptions="Center"
                    Margin="8,0,0,0" />

                <ImageButton
                    Grid.Column="2"
                    Source="close.png"
                    WidthRequest="22"
                    HeightRequest="22"
                    BackgroundColor="Transparent"
                    HorizontalOptions="End"
                    VerticalOptions="Center"
                    Clicked="OnCancelRecordingClicked" />
            </Grid>

            <!-- BARRA DE INPUT -->
            <Grid Grid.Row="1"
                  ColumnDefinitions="Auto,*,Auto,Auto"
                  ColumnSpacing="8">

                <!-- Botão imagem -->
                <ImageButton
                    Grid.Column="0"
                    Source="image.png"
                    WidthRequest="26"
                    HeightRequest="26"
                    BackgroundColor="Transparent"
                    VerticalOptions="Center"
                    Clicked="OnAttachImageClicked" />

                <!-- Entrada de texto -->
                <Frame
                    Grid.Column="1"
                    BackgroundColor="White"
                    CornerRadius="20"
                    Padding="12,6"
                    HasShadow="False"
                    BorderColor="#E0E0E0">
                    <Entry
                        x:Name="MessageEntry"
                        Placeholder="Mensagem..."
                        FontSize="14"
                        TextColor="#222222"
                        Completed="OnEntryCompleted" />
                </Frame>

                <!-- Botão gravar áudio -->
                <ImageButton
                    Grid.Column="2"
                    x:Name="RecordAudioButton"
                    Source="mic.png"
                    WidthRequest="26"
                    HeightRequest="26"
                    BackgroundColor="Transparent"
                    VerticalOptions="Center"
                    Clicked="OnRecordAudioClicked" />

                <!-- Botão enviar texto -->
                <ImageButton
                    Grid.Column="3"
                    Source="send.png"
                    WidthRequest="28"
                    HeightRequest="28"
                    BackgroundColor="Transparent"
                    VerticalOptions="Center">
                    <ImageButton.GestureRecognizers>
                        <TapGestureRecognizer Tapped="OnSendTapped" />
                    </ImageButton.GestureRecognizers>
                </ImageButton>

            </Grid>
        </Grid>

        <!-- OVERLAY DE IMAGEM EM TELA CHEIA -->
        <Grid x:Name="FullImageOverlay"
              RowSpan="3"
              BackgroundColor="#CC000000"
              IsVisible="False">

            <Grid>
                <Image
                    x:Name="FullImageView"
                    Aspect="AspectFit"
                    HorizontalOptions="Center"
                    VerticalOptions="Center" />

                <ImageButton
                    Source="close.png"
                    WidthRequest="32"
                    HeightRequest="32"
                    BackgroundColor="Transparent"
                    HorizontalOptions="End"
                    VerticalOptions="Start"
                    Margin="16"
                    Clicked="OnCloseFullImageClicked" />
            </Grid>
        </Grid>

    </Grid>

</ContentPage>
